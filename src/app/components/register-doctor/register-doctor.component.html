<div class="bg-white rounded-3 p-3 text-center width">
    <div class="mb-3">
        <a class="text-decoration-none fs-6 align-middle" routerLink="/welcome/login">
            <mat-icon class="align-middle">arrow_back</mat-icon>
            <span class="ms-1 align-middle">Back to login</span>
        </a>      
    </div>
    
    <h1 class="fw-bold">Doctor registration</h1>
    <form class="d-flex flex-column" [formGroup]="form">
        <div class="d-flex flex-column flex-md-row gap-2">
            <div class="d-flex flex-column col-md-6">
                <mat-form-field appearance="fill">
                    <mat-label>Username</mat-label>
                    <input matInput placeholder="Username" formControlName="username"/>
                    <mat-icon matPrefix>account_circle</mat-icon>
                    @if (form.get('username').hasError('required')) {
                        <mat-error>Username is required</mat-error>
                    } @else {
                        @if (form.get('username').hasError('minlength') || form.get('username').hasError('maxlength')) {
                            <mat-error>Username should be 5-30 characters</mat-error>
                        } 
                        @else if (form.get('username').hasError('pattern')) {
                            <mat-error>Username should not have white spaces</mat-error>
                        } 
                    }
                </mat-form-field>
        
                <mat-form-field appearance="fill">
                    <mat-label>Password</mat-label>
                    <input matInput [type]="hide ? 'password' : 'text'" placeholder="Password" formControlName="password"/>
                    <mat-icon matPrefix>lock</mat-icon>
                    <mat-icon matSuffix (click)="hide = !hide">
                        {{ hide ? 'visibility_off' : 'visibility'}}
                    </mat-icon>
                    @if (form.get('password').hasError('required')) {
                        <mat-error>Password is required</mat-error>
                    }
                </mat-form-field>
        
                <mat-form-field appearance="fill">
                    <mat-label>Confirm Password</mat-label>
                    <input matInput type="password" placeholder="Confirm Password" formControlName="confirmPassword"/>
                    <mat-icon matPrefix>lock</mat-icon>    
                    @if (form.get('confirmPassword').hasError('passwordMismatch')) {
                        <mat-error>Passwords should be the same</mat-error>
                    }
                </mat-form-field>
        
                <mat-form-field appearance="fill">
                    <mat-label>Email</mat-label>
                    <input matInput placeholder="Email" formControlName="email"/>
                    <mat-icon matPrefix>email</mat-icon>
                    @if (form.get('email').hasError('required')) {
                        <mat-error>Email is required</mat-error>
                    } @else {
                        @if (form.get('email').hasError) {
                            <mat-error>Email is not valid</mat-error>
                        }
                    }
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <mat-label>Firstname</mat-label>
                    <input matInput placeholder="Firstname" formControlName="firstname"/>
                    <mat-icon matPrefix>person</mat-icon>
                    @if (form.get('firstname').hasError('required')) {
                        <mat-error>Firstname is required</mat-error>
                    } @else {
                        @if (form.get('firstname').hasError('minlength') || form.get('firstname').hasError('maxlength')) {
                            <mat-error>Firstname should be 3-50 characters</mat-error>
                        }
                        @else if (form.get('firstname').hasError('pattern')) {
                            <mat-error>White spaces are not allowed</mat-error>
                        }             
                    }
                </mat-form-field>
        
                <mat-form-field appearance="fill">
                    <mat-label>Lastname</mat-label>
                    <input matInput placeholder="Lastname" formControlName="lastname"/>
                    <mat-icon matPrefix>person_outline</mat-icon>
                    @if (form.get('lastname').hasError('required')) {
                        <mat-error>Lastname is required</mat-error>
                    } @else {
                        @if (form.get('lastname').hasError('minlength') || form.get('lastname').hasError('maxlength')) {
                            <mat-error>Lastname should be 3-50 characters</mat-error>
                        }
                        @else if (form.get('lastname').hasError('pattern')) {
                            <mat-error>White spaces are not allowed</mat-error>
                        }
                    }
                </mat-form-field>
            </div>
            <div class="d-flex flex-column col-md-6">
        
                <mat-form-field appearance="fill">
                    <mat-label>Phone number</mat-label>
                    <input matInput type="tel" placeholder="Phone number" formControlName="phoneNumber"/>
                    <mat-icon matPrefix>phone</mat-icon>
                    @if (form.get('phoneNumber').hasError('required')) {
                        <mat-error>Phone number is required</mat-error>
                    } @else if (form.get('phoneNumber').hasError('pattern')) {
                        <mat-error>Phone number is not valid</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <mat-label>City</mat-label>
                    <input matInput placeholder="City" formControlName="city"/>
                    <mat-icon matPrefix>location_city</mat-icon>
                    @if (form.get('city').hasError('required')) {
                        <mat-error>City is required</mat-error>
                    } @else if (form.get('city').hasError('minlength') || form.get('city').hasError('maxlength')) {
                        <mat-error>City should be 3-50 characters</mat-error>
                    } @else if (form.get('city').hasError('pattern')) {
                        <mat-error>Remove spaces at beginning and end</mat-error>
                    }
                </mat-form-field>
        
                <mat-form-field appearance="fill">
                    <mat-label>Address</mat-label>
                    <input matInput placeholder="Address" formControlName="address"/>
                    <mat-icon matPrefix>home</mat-icon>
                    @if (form.get('address').hasError('required')) {
                        <mat-error>Address is required</mat-error>
                    } @else if (form.get('address').hasError('minlength') || form.get('address').hasError('maxlength')) {
                        <mat-error>Address should be 3-50 characters</mat-error>
                    } @else if (form.get('address').hasError('pattern')) {
                        <mat-error>Remove spaces at beginning and end</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <mat-label>Street Number</mat-label>
                    <input matInput type="number" placeholder="Street Number" formControlName="streetNumber"/>
                    <mat-icon matPrefix>place</mat-icon>
                    @if (form.get('streetNumber').hasError('required')) {
                        <mat-error>Street Number is required</mat-error>
                    } @else if (form.get('streetNumber').hasError('min')) {
                        <mat-error>The street number is not valid</mat-error>
                    }
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <mat-label>Speciality</mat-label>
                    <input matInput placeholder="Speciality" formControlName="speciality"/>
                    <mat-icon matPrefix>work</mat-icon>
                    @if (form.get('speciality').hasError('required')) {
                        <mat-error>Speciality is required</mat-error>
                    } @else if (form.get('speciality').hasError('minlength') || form.get('speciality').hasError('maxlength')) {
                        <mat-error>Speciality should be 5-80 characters</mat-error>
                    } @else if (form.get('speciality').hasError('pattern')) {
                        <mat-error>Remove spaces at beginning and end</mat-error>
                    }
                </mat-form-field>

                <div>
                    <div>
                        <mat-icon>timer</mat-icon>
                        <label>Appointment duration (30 min. default)</label>
                        <input type="range" min="15" max="60" step="5" placeholder="Appointment duration" (input)="changeDurationValue()" formControlName="appointmentDuration"/>
                    </div>
                   <span>{{ durationValue }} minutes</span>
                </div>
                               
            </div>
        </div>
      
        <button [disabled]="!form.valid" class="btn btn-primary w-50 mx-auto mt-3" (click)="registerDoctor()">Sign up</button>
    </form>
    @if (form.get('password').hasError('pattern')) {
        <div class="mt-3 alert alert-danger">       
            <div>Password should be at least 8 characters containing at least one uppercase and one lowercase letter,
                one digit and one special character</div>           
        </div>
    }   

    @if (errorMessage) {
        <div class="alert alert-danger mt-2">
            <strong>Error: </strong>
            {{errorMessage}}
        </div>
    }
    @if (errors) {
        <ul class="alert alert-danger">
            @for (error of errorList; track error) {
                <li>{{ error}}</li>
            }                             
        </ul>
    }   
</div>

